{% load render_bundle from webpack_loader %}
{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Настоящая Черная Пятница</title>
    <meta name="description" content="">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.2/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.2/toastr.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js"></script>

    <link rel="stylesheet" href="{% static 'css/multi-select.css' %}">
    <script src="{% static 'js/jquery.multi-select.js' %}"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.11.1/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/locale/ru.js"></script>

    <link rel="stylesheet" href="{% static 'css/bootstrap3-wysihtml5.min.css' %}">
    <script src="{% static 'js/bootstrap3-wysihtml5.all.min.js' %}"></script>
    <script src="{% static 'js/bootstrap-wysihtml5.ru-RU.js' %}"></script>

    {% if debug %}
        <script src="{% static 'js/FileSaver.js' %}"></script>
    {% else %}
        <script src="{% static 'js/FileSaver.min.js' %}"></script>
    {% endif %}

    <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic" rel="stylesheet">

    {# CSS #}
    {% render_bundle 'admin' 'css' %}
    {% block css %}{% endblock css %}

    <!--[if lt IE 9]>
    <script src="{% static 'js/html5shiv.min.js' %}"></script>
    <script src="{% static 'js/respond.min.js' %}"></script>
    <script src="{% static 'js/es5-shim.min.js' %}"></script>
    <script src="{% static 'js/es5-sham.min.js' %}"></script>
    <script src="{% static 'js/ie8.js' %}"></script>
    <![endif]-->
</head>
<body class="site">

<div class="site-main">
    <aside class="site-sidebar">
        <div class="site-sidebar__header">
            <header class="site-header">
                <a href="/admin/" class="logo site-header__logo">
                    <img src="{% static 'images/admin/logo.png' %}" alt="Настоящая Черная Пятница">
                </a>
            </header>
        </div>

        <div class="site-sidebar__container">
            <nav class="site-nav js-navbar">
                <ul class="simple-menu site-nav__simple-menu">
                    {% block navbar %}
                        {# Admin Menu #}
                        {% if user.role == 'admin' %}
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'advertisers:merchant-list' %}">
                                    Магазины
                                </a>
                            </li>
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'advertisers:advertiser-list' %}">
                                    Рекламодатели
                                </a>
                            </li>
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'users:user-list' %}">
                                    Пользователи
                                </a>
                            </li>
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'catalog:category-list' %}">
                                    Категории
                                </a>
                            </li>

                        {# Manager Menu #}
                        {% elif user.role == 'manager' %}
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'advertisers:merchant-list' %}">
                                    Магазины
                                </a>
                            </li>
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'advertisers:advertiser-list' %}">
                                    Рекламодатели
                                </a>
                            </li>
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'users:user-list' %}">
                                    Пользователи
                                </a>
                            </li>
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'catalog:category-list' %}">
                                    Категории
                                </a>
                            </li>

                        {# Advertiser Menu #}
                        {% elif user.role == 'advertiser' %}
                            <li class="simple-menu__item">
                                <a class="simple-menu__link" href="{% url 'advertisers:merchant-list' %}">
                                    Магазины
                                </a>
                            </li>
                        {% endif %}
                    {% endblock navbar %}
                </ul>
            </nav>
            <script>
            (function () {
                // Грязный хак подсветки текущего пункта
                var pathname = window.location.pathname;
                var $navbar = $('.js-navbar');
                $navbar.find('a').each(function () {
                    var $this = $(this);
                    if (pathname.indexOf($this.attr('href')) >= 0) {
                        $this.parent().addClass('is-active');
                    }
                });
            })();
            </script>
        </div>

        <div class="site-sidebar__footer">
            <footer class="site-footer">
                {% if user.role == 'advertiser' %}
                <a
                    class="site-footer__feedback"
                    href="#"
                    data-toggle="modal"
                    data-target="#feedback-modal"
                    >
                    Служба поддержки
                </a>
                {% endif %}

                <a class="akit-copy" href="http://www.akit.ru/" target="_blank" rel="noopener noreferrer">
                    <img class="akit-copy__logo" src="{% static 'images/admin/akit-logo.png' %}" alt="retail hotline" title="" />Ассоциация компаний интернет-торговли
                </a>

                <div class="copyrights">
                    © 2002 — 2016 «Настоящая Черная Пятница».
                </div>
            </footer>
        </div>
    </aside>

    <main class="site-content">

        {% block content %}{% endblock %}

    </main>
</div>

{% if user.role == 'advertiser' %}
    {# Форма обратной связи #}
    {% include "includes/feedback-modal.html" %}
{% endif %}

<script>
$(function () {
    // Кнопки генерации страницы
    $('.js-generate-page').on('click', function () {
        var $this = $(this);

        $.ajax({
            type: 'GET',
            url: $this.data('url'),
            data: $this.data('data') || '',
            beforeSend: function () {
                $this.prop('disabled', true);
            },
            complete: function () {
                $this.prop('disabled', false);
            },
            success: function () {
                toastr.success('Страница сгенерирована');
            },
            error: function () {
                toastr.error('Не удалось сгенерировать страницу');
            }
        });
    });

    // Bootstrap Popover and Tooltip
    $('[data-toggle="popover"]').popover();
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

<script>
(function () {
    window.processErrors = function (errors) {
        process(errors);
    }

    function process(errors) {
        if (_.isArray(errors)) {
            processArray(errors);
        } else if (_.isObject(errors)) {
            processObject(errors);
        } else if (_.isString(errors)) {
            processString(errors);
        }
    }
    function processObject(errors) {
        _.forEach(errors, process);
    }
    function processArray(errors) {
        _.forEach(errors, process);
    }
    function processString(error) {
        toastr.warning(error);
    }
})();

window.ENV = {
    imgBaseUrl: '/media/images/',
    imgStaticBaseUrl: '/',
    userId: {{ user.id }},
    userRoles: ['{{ user.role }}']
};
</script>

{# JS #}
{% block js %}{% endblock js %}

{% render_bundle 'admin' 'js' %}

</body>
</html>
